name: Issue Reminder

on:
  workflow_dispatch:
    inputs:
      issue_number:
        description: 'Issue number to remind about'
        required: true
        type: number
      remind_in:
        description: 'Remind me in'
        required: true
        type: choice
        options:
          - '3 days'
          - '1 week'
          - '2 weeks'
          - '1 month'

jobs:
  set-reminder:
    runs-on: ubuntu-latest
    steps:
      - name: Add reminder label
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: ${{ inputs.issue_number }},
              labels: ['â° reminder-set']
            });
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: ${{ inputs.issue_number }},
              body: `â° Reminder set for **${{ inputs.remind_in }}** by @${context.actor}`
            });

      - name: Calculate reminder date
        id: date
        run: |
          case "${{ inputs.remind_in }}" in
            "3 days")
              DAYS=3
              ;;
            "1 week")
              DAYS=7
              ;;
            "2 weeks")
              DAYS=14
              ;;
            "1 month")
              DAYS=30
              ;;
          esac
          
          if [[ "$OSTYPE" == "darwin"* ]]; then
            REMIND_DATE=$(date -v+${DAYS}d -u +"%Y-%m-%dT%H:%M:%SZ")
          else
            REMIND_DATE=$(date -u -d "+${DAYS} days" +"%Y-%m-%dT%H:%M:%SZ")
          fi
          
          echo "remind_date=$REMIND_DATE" >> $GITHUB_OUTPUT
          echo "Reminder will trigger at: $REMIND_DATE"

      - name: Schedule reminder
        uses: actions/github-script@v7
        with:
          script: |
            const reminderDate = '${{ steps.date.outputs.remind_date }}';
            const issueNumber = ${{ inputs.issue_number }};
            const actor = context.actor;
            
            // Store reminder data in issue comment (hidden metadata)
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              body: `<!-- reminder:${reminderDate}:${actor} -->\nðŸ”” I'll remind you about this on ${new Date(reminderDate).toLocaleDateString()}`
            });
